<section class="queue container">
  <h2>Tu Gramola</h2>
  <div class="billing">
    <span>Precio por canci√≥n: {{ pricePerSong }} moneda(s)</span>
    <span>‚Ä¢ Saldo: {{ coins }}</span>
    <button class="btn" (click)="demoRecharge()" type="button">A√±adir saldo</button>
  </div>

  <form (ngSubmit)="search()" class="search">
    <input [(ngModel)]="q" name="q" placeholder="Buscar canciones o artistas" />
    <button type="submit" class="btn" [disabled]="loading">{{ loading ? 'Buscando‚Ä¶' : 'Buscar' }}</button>
  </form>

  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="results.length" class="results">
    <h3>Resultados</h3>
    <ul>
      <li *ngFor="let t of results">
        <img *ngIf="t.imageUrl" [src]="t.imageUrl" alt="" />
        <div class="meta">
          <div class="title">{{ t.title }}</div>
          <div class="sub">{{ t.artists.join(', ') }} ‚Äî {{ t.album }}</div>
        </div>
        <div class="actions-inline">
          <button class="btn outline" (click)="add(t)" [disabled]="isInQueue(t.id)">
            {{ isInQueue(t.id) ? ('En cola (pos. ' + (inQueuePosition(t.id)+1) + ')' ) : 'A√±adir a cola' }}
          </button>
        </div>
      </li>
    </ul>
  </div>

  <div class="current">
    <div class="header">
      <h3>Cola actual</h3>
      <button class="btn outline" (click)="clear()" [disabled]="!queue.length">Vaciar</button>
    </div>
    <ul>
      <li *ngFor="let i of queue">
        <img *ngIf="i.imageUrl" [src]="i.imageUrl" alt="" />
        <div class="meta">
          <div class="title">{{ i.title }}</div>
          <div class="sub">{{ i.artists }} ‚Äî {{ i.album }}</div>
        </div>
        <div class="actions-inline">
          <button class="btn outline" (click)="remove(i)">Quitar</button>
        </div>
      </li>
    </ul>
    <p *ngIf="!queue.length" class="muted">A√∫n no hay canciones en la cola.</p>
  </div>

  <div class="toast" *ngIf="toast.visible">{{ toast.message }}</div>

  <app-payments *ngIf="showPayments" (paid)="onPaid()" (closed)="showPayments=false"></app-payments>

  <!-- Playback bar (simulated) -->
  <div class="player" *ngIf="current">
    <img *ngIf="current.imageUrl" class="cover" [src]="current.imageUrl" alt="" />
    <div class="info">
      <div class="title">{{ current.title }}</div>
      <div class="sub">{{ current.artists }} ‚Äî {{ current.album }}</div>
    </div>
    <div class="controls">
      <button class="btn icon circle" (click)="previous()" title="Anterior">‚èÆ</button>
      <button class="btn icon circle" (click)="togglePause()" [attr.title]="isPaused ? 'Reanudar' : 'Pausar'">{{ isPaused ? '‚ñ∂' : '‚è∏' }}</button>
      <button class="btn icon circle" (click)="next()" title="Siguiente">‚è≠</button>
      <button class="btn icon circle" (click)="stop()" title="Detener">‚èπ</button>
      <button class="btn outline icon circle" (click)="removeCurrent()" title="Quitar">üóë</button>
    </div>
    <div class="progress" (click)="seek($event)" (mousedown)="onProgressDown($event)">
      <div class="bar"><span [style.width.%]="progressPercent"></span></div>
      <div class="times">
        <span>{{ formatTime(totalMs - remainingMs) }}</span>
        <span>{{ formatTime(totalMs) }}</span>
      </div>
    </div>
    <div class="meta">
      <span class="muted">Quedan {{ remainingSongs }} canci√≥n(es) ‚Äî Tiempo estimado {{ formatTime(remainingQueueMs) }}</span>
    </div>
  </div>
</section>
