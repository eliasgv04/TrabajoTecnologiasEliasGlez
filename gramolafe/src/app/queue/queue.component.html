<section class="queue container">
  <h2>Tu Gramola</h2>
  <div class="billing">
    <span>Precio por canci√≥n: 1‚Äì3 monedas seg√∫n popularidad</span>
    <span>‚Ä¢ Saldo: {{ coins }}</span>
  </div>

  <form (ngSubmit)="search()" class="search">
    <input [(ngModel)]="q" name="q" placeholder="Buscar canciones o artistas" />
    <button type="submit" class="btn" [disabled]="loading">{{ loading ? 'Buscando‚Ä¶' : 'Buscar' }}</button>
  </form>

  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="results.length" class="results">
    <h3>Resultados</h3>
    <ul>
      <li *ngFor="let t of results">
        <img *ngIf="t.imageUrl" [src]="t.imageUrl" alt="" />
        <div class="meta">
          <div class="title">{{ t.title }}</div>
          <div class="sub">{{ t.artists.join(', ') }} ‚Äî {{ t.album }}</div>
          <div class="price-pill" *ngIf="priceFor(t.id) as p">Coste: <strong>{{ p }}</strong> moneda(s) <span class="muted" *ngIf="popularityFor(t.id) as pop">(popularidad {{ pop }})</span></div>
        </div>
        <div class="actions-inline" *ngIf="pendingAddId !== t.id">
          <button class="btn outline" (click)="add(t)" [disabled]="isInQueue(t.id)">
            {{ isInQueue(t.id) ? ('En cola (pos. ' + (inQueuePosition(t.id)+1) + ')' ) : ('A√±adir a cola' + (priceFor(t.id) ? ' (' + priceFor(t.id) + ' moneda/s)' : '')) }}
          </button>
        </div>
        <div class="confirm" *ngIf="pendingAddId === t.id">
          <ng-container *ngIf="priceFor(t.id) as p">
            <span>Esta canci√≥n costar√° <strong>{{ p }}</strong> moneda(s).</span>
            <div class="confirm-actions">
              <button class="btn" (click)="performAdd(t, p)">Confirmar</button>
              <button class="btn outline" (click)="cancelAdd()">Cancelar</button>
            </div>
          </ng-container>
        </div>
      </li>
    </ul>
  </div>

  <div class="current">
    <div class="header">
  <h3>Cola actual</h3>
  <button class="btn outline" (click)="clear()" [disabled]="!queue.length">Vaciar</button>
    </div>
    <p class="muted" *ngIf="!queue.length && fallbackTracks.length">Reproduciendo lista por defecto cuando la cola est√° vac√≠a.</p>
    <p class="muted" *ngIf="!queue.length && !fallbackTracks.length">No hay lista por defecto configurada para este bar.</p>
    <ul>
      <li *ngFor="let i of queue">
        <img *ngIf="i.imageUrl" [src]="i.imageUrl" alt="" />
        <div class="meta">
          <div class="title">{{ i.title }}</div>
          <div class="sub">{{ i.artists }} ‚Äî {{ i.album }}</div>
          <div class="price-pill" *ngIf="i.chargedPrice">Cobr√≥: <strong>{{ i.chargedPrice }}</strong> moneda(s) <span class="muted" *ngIf="i.popularity">(popularidad {{ i.popularity }})</span></div>
        </div>
        <div class="actions-inline">
          <button class="btn outline" (click)="remove(i)">Quitar</button>
        </div>
      </li>
    </ul>
    <p *ngIf="!queue.length" class="muted">A√∫n no hay canciones en la cola.</p>
  </div>

  <div class="toast" *ngIf="toast.visible">{{ toast.message }}</div>

  

  <!-- Playback bar (simulated) -->
  <div class="player" *ngIf="current">
    <img *ngIf="current.imageUrl" class="cover" [src]="current.imageUrl" alt="" />
    <div class="info">
      <div class="title">{{ current.title }}</div>
      <div class="sub">{{ current.artists }} ‚Äî {{ current.album }}</div>
    </div>
    <div class="controls">
      <button class="btn icon circle" (click)="previous()" title="Anterior">‚èÆ</button>
      <button class="btn icon circle" (click)="togglePause()" [attr.title]="isPaused ? 'Reanudar' : 'Pausar'">{{ isPaused ? '‚ñ∂' : '‚è∏' }}</button>
      <button class="btn icon circle" (click)="next()" title="Siguiente">‚è≠</button>
      <button class="btn icon circle" (click)="stop()" title="Detener">‚èπ</button>
      <button class="btn outline icon circle" (click)="removeCurrent()" title="Quitar">üóë</button>
    </div>
    <div class="progress" (click)="seek($event)" (mousedown)="onProgressDown($event)">
      <div class="bar"><span [style.width.%]="progressPercent"></span></div>
      <div class="times">
        <span>{{ formatTime(totalMs - remainingMs) }}</span>
        <span>{{ formatTime(totalMs) }}</span>
      </div>
    </div>
    <div class="meta">
      <span class="muted">Quedan {{ remainingSongs }} canci√≥n(es) ‚Äî Tiempo estimado {{ formatTime(remainingQueueMs) }}</span>
    </div>
  </div>
  <!-- Fallback player UI when playing default playlist -->
  <div class="player" *ngIf="!current && currentFallback as fb">
    <img *ngIf="fb.imageUrl" class="cover" [src]="fb.imageUrl" alt="" />
    <div class="info">
      <div class="title">{{ fb.title }}</div>
      <div class="sub">{{ fb.artists.join(', ') }} ‚Äî {{ fb.album }}</div>
    </div>
    <div class="controls">
      <button class="btn icon circle" (click)="previous()" title="Anterior">‚èÆ</button>
      <button class="btn icon circle" (click)="togglePause()" [attr.title]="isPaused ? 'Reanudar' : 'Pausar'">{{ isPaused ? '‚ñ∂' : '‚è∏' }}</button>
      <button class="btn icon circle" (click)="next()" title="Siguiente">‚è≠</button>
      <button class="btn icon circle" (click)="stop()" title="Detener">‚èπ</button>
    </div>
    <div class="progress" (click)="seek($event)" (mousedown)="onProgressDown($event)">
      <div class="bar"><span [style.width.%]="progressPercent"></span></div>
      <div class="times">
        <span>{{ formatTime(totalMs - remainingMs) }}</span>
        <span>{{ formatTime(totalMs) }}</span>
      </div>
    </div>
    <div class="meta">
      <span class="muted">Reproduciendo lista por defecto</span>
    </div>
  </div>
</section>
